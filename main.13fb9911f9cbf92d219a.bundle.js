!function(e){function t(t){for(var n,i,a=t[0],r=t[1],s=0,l=[];s<a.length;s++)i=a[s],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&l.push(o[i][0]),o[i]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);for(c&&c(t);l.length;)l.shift()()}var n={},o={1:0};function i(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.e=function(e){var t=[],n=o[e];if(0!==n)if(n)t.push(n[2]);else{var a=new Promise((function(t,i){n=o[e]=[t,i]}));t.push(n[2]=a);var r,s=document.createElement("script");s.charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.src=function(e){return i.p+""+({}[e]||e)+".13fb9911f9cbf92d219a.bundle.js"}(e);var c=new Error;r=function(t){s.onerror=s.onload=null,clearTimeout(l);var n=o[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+i+": "+a+")",c.name="ChunkLoadError",c.type=i,c.request=a,n[1](c)}o[e]=void 0}};var l=setTimeout((function(){r({type:"timeout",target:s})}),12e4);s.onerror=s.onload=r,document.head.appendChild(s)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var a=window.webpackJsonp=window.webpackJsonp||[],r=a.push.bind(a);a.push=t,a=a.slice();for(var s=0;s<a.length;s++)t(a[s]);var c=r;i(i.s=6)}([function(e,t){var n={},o=document.querySelector(".app__snackbar"),i=null;n.show=(e,t=4e3)=>{e&&(i&&i.remove(),(i=document.createElement("div")).className="app__snackbar-msg",i.textContent=e,o.appendChild(i),setTimeout(()=>{i.remove()},t))},t.snackbar=n},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(0);class i{constructor(){this.name=null,this.layout=document.createElement("div"),this.layout.classList.add("page-layout"),this.layout.appendChild(this.addHeaderBar()),this.layout.appendChild(this.addPageContent())}getName(){return this.name}addHeaderBar(){return this.header=document.createElement("div"),this.header.classList.add("page-header"),this.logout=document.createElement("button"),this.logout.classList.add("logout-button"),this.logout.addEventListener("click",e=>conector.logout().then(e=>{o.snackbar.show("You have been logged out"),nav.login()}),!1),this.header.appendChild(this.logout),this.app_title=document.createElement("div"),this.app_title.classList.add("app-title"),this.app_title.addEventListener("click",e=>{nav.eventsList()},!1),conector.addEventListener("poll-change",e=>{this.app_title.innerText=e.name}),conector.hasActivePoll()?this.app_title.innerText=conector.getActivePoll().name:this.app_title.innerText="QR Scanner (pendiente seleciÃ³n de evento)",this.header.appendChild(this.app_title),this.header}addPageContent(){return this.content=document.createElement("div"),this.content.classList.add("page-content"),this.content}show(e){nav.backupPage(this),e&&!this.container&&(this.container=e),cleaner(this.container),this.container.appendChild(this.layout)}addNavigationBlock(e){this.navigationBlock=document.createElement("div"),this.navigationBlock.classList.add("navigation-bar"),e.appendChild(this.navigationBlock),this.backButton=document.createElement("button"),this.backButton.classList.add("back-arrow"),conector.hasActivePoll()||this.backButton.classList.add("hide"),this.backButton.addEventListener("click",e=>{nav.home()},!1),this.navigationBlock.appendChild(this.backButton)}addNavigationTitle(e){this.title=document.createElement("div"),this.title.innerText=e,this.title.classList="div-title",this.navigationBlock.appendChild(this.title)}}},function(e,t,n){"use strict";var o=n(0),i={};function a(e){!e&&window.isMediaStreamAPISupported?i.webcam=document.querySelector("video"):i.webcam=document.querySelector("img")}i.active=!1,i.webcam=null,i.canvas=null,i.ctx=null,i.decoder=null,i.setCanvas=()=>{i.canvas=document.createElement("canvas"),i.ctx=i.canvas.getContext("2d")},i.init=()=>{var e=!1;function t(){i.canvas.width=window.innerWidth,i.canvas.height=window.innerHeight}function n(e){navigator.mediaDevices.getUserMedia(e).then((function(e){i.webcam.srcObject=e,i.webcam.setAttribute("playsinline",!0),i.webcam.setAttribute("controls",!0),setTimeout(()=>{document.querySelector("video").removeAttribute("controls")})})).catch((function(e){console.log("Error occurred ",e),r()}))}function r(){window.noCameraPermission=!0,document.querySelector(".custom-scanner").style.display="none",o.snackbar.show("Unable to access the camera",1e4)}a(),i.setCanvas(),i.decoder=new Worker("decoder.js"),window.isMediaStreamAPISupported?i.webcam.addEventListener("play",(function(n){e||(t(),e=!0)}),!1):t(),window.isMediaStreamAPISupported&&navigator.mediaDevices.enumerateDevices().then((function(e){var t,o=e.filter((function(e){e.label.split(",")[1];if("videoinput"==e.kind)return e}));o.length>1?(t={video:{mandatory:{sourceId:o[1].deviceId?o[1].deviceId:null}},audio:!1},window.iOS&&(t.video.facingMode="environment"),n(t)):o.length?(t={video:{mandatory:{sourceId:o[0].deviceId?o[0].deviceId:null}},audio:!1},window.iOS&&(t.video.facingMode="environment"),n(t)):n({video:!0})})).catch((function(e){r(),console.error("Error occurred : ",e)}))},i.scan=function(e,t){function n(){if(i.active)try{i.ctx.drawImage(i.webcam,0,0,i.canvas.width,i.canvas.height);var e=i.ctx.getImageData(0,0,i.canvas.width,i.canvas.height);e.data&&i.decoder.postMessage(e)}catch(e){"NS_ERROR_NOT_AVAILABLE"==e.name&&setTimeout(n,0)}}i.active=!0,i.setCanvas(),i.decoder.onmessage=function(t){if(t.data.length>0){var o=t.data[0][2];i.active=!1,e(o)}setTimeout(n,0)},setTimeout(()=>{a(t)}),n()},t.a=i},,function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var o=n(1);class i extends o.a{constructor(){super(),this.name="list",this.list=null,null!==localStorage.getItem("events-list")&&(this.list=JSON.parse(localStorage.getItem("events-list"))),this.contentBlock=document.createElement("div"),this.contentBlock.classList.add("content-block","content-list"),this.addNavigationBlock(this.contentBlock),this.addNavigationTitle("Listado"),this.contentList=document.createElement("ul"),this.contentList.classList.add("content-list-ul"),this.contentBlock.appendChild(this.contentList);var e=null;conector.events().then(e=>{this.list=e.data||null}),new Promise((e,t)=>{if(null!==this.list)e(this.list);else{const n=setInterval(()=>{null!==this.list&&(clearInterval(n),this.list.length>0?e(this.list):t())},1e3)}}).then(e=>(localStorage.setItem("events-list",JSON.stringify(e)),e)).then(t=>(cleaner(this.contentList),this.list.forEach(t=>{(e=document.createElement("li")).classList.add("list-item"),e.setAttribute("event",JSON.stringify(t)),e.addEventListener("click",e=>{localStorage.setItem("api-poll",e.target.parentElement.parentElement.getAttribute("event")),conector.reloadActivePoll(),nav.back()},!1);var n=document.createElement("div"),o=document.createElement("span");o.classList.add("span-event-name"),o.innerText=t.name,n.appendChild(o),e.appendChild(n);var i=document.createElement("span");i.classList.add("count-badge"),i.innerHTML="&nbsp;",n.appendChild(i);var a=document.createElement("button");a.classList.add("check-event"),n.appendChild(a),this.contentList.appendChild(e)}),document.querySelectorAll("li.list-item div button").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation();var t=JSON.parse(e.target.parentElement.parentElement.getAttribute("event"));conector.countNum(t.id).then(t=>{for(let n of e.target.parentNode.children)n.classList.contains("count-badge")&&(n.innerText=t.numrows)})},!1)}),t))}show(e){nav.backupPage(this),this.container&&this.container.contains(this.content)||super.show(e),cleaner(this.content),this.content.appendChild(this.contentBlock)}}},function(e,t){e.exports=function(e){if("string"!=typeof e)return!1;var t=e.match(n);if(!t)return!1;var a=t[1];if(!a)return!1;if(o.test(a)||i.test(a))return!0;return!1};var n=/^(?:\w+:)?\/\/(\S+)$/,o=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,i=/^[^\s\.]+\.\S{2,}$/},function(e,t,n){"use strict";n.r(t);n(2);var o=n(0);var i={show:function(){document.querySelector(".dialog_div_overlay").classList.remove("hide")},hide:function(){document.querySelector(".dialog_div_overlay").classList.add("hide")}};class a{constructor(){this.config=null,this.passport=null,this.poll=null,this.pool={},this.getConfig(),this.getPassport(),this.hasActivePoll()}getConfig(){return null!==this.config?new Promise(()=>this.config):fetch("config.json").then(e=>e.json()).then(e=>(this.config=e,this.config)).catch(e=>{o.snackbar.show("Failed to load configuration")})}isLoggedIn(){return null!==this.getPassport()}hasActivePoll(){return null!==this.getActivePoll()}getPassport(){return null===this.passport&&(this.passport=localStorage.getItem("api-passport")),this.passport}getActivePoll(){return null===this.poll&&null!==localStorage.getItem("api-poll")&&(this.poll=JSON.parse(localStorage.getItem("api-poll")),this.trigger("poll-change",this.poll)),this.poll}reloadActivePoll(){return this.poll=JSON.parse(localStorage.getItem("api-poll")),this.trigger("poll-change",this.poll),this.poll}login(e,t){return this.fetch(this.url({service:"Login",login:e,password:t})).then(e=>(!0===e.success&&(this.passport=e.passport,localStorage.setItem("api-passport",this.passport)),o.snackbar.show(e.message),e))}url(e){return e=Object.assign({},this.config.params,e),this.isLoggedIn()&&(e=Object.assign({},e,{passport:this.getPassport()})),this.config.url+"?"+new URLSearchParams(e).toString()}logout(){return new Promise((e,t)=>{this.isLoggedIn()||t(),this.passport=null,localStorage.removeItem("api-passport"),e()})}checkQR(e){return this.hasActivePoll()?this.fetch(this.url({service:"Poll",action:"checkQR",poll:this.getActivePoll().id,data:e})):new Promise((t,n)=>{o.snackbar.show("Todavia no tiene elegido ningun evento"),n(e)})}countNum(e){return this.fetch(this.url({service:"Poll",action:"countQrChecked",poll:e}))}fetch(e,t){return i.show(),fetch(e,t).then(e=>(i.hide(),e.json())).catch(e=>(i.hide(),o.snackbar.show(e),e))}events(){return this.fetch(this.url({service:"Poll",action:"getList"}))}checkUser(e){return this.fetch(this.url({service:"Poll",action:"checkUser",user:e,poll:this.getActivePoll().id}))}setAnswer(e){return this.fetch(this.url({service:"Poll",action:"setVote",user:e,poll:this.getActivePoll().id,answer:""}))}addEventListener(e,t){void 0===this.pool[e]&&(this.pool[e]=[]),this.pool[e].push(t)}removeEventListeners(e){void 0!==this.pool[e]&&delete this.pool[e]}trigger(e,t){void 0!==this.pool[e]&&this.pool[e].forEach(e=>{e(t)})}}n(4);class r{constructor(){this.current=null,this.last=null}backupPage(e){null!==this.current&&e.getName()===this.current.getName()||(this.last=this.current,this.current=e)}back(){if(null!==this.current&&null!==this.last){var e=this.current;this.current=this.last,this.last=e,this.current.show()}}login(){if(this.loginPage)this.loginPage.show();else{const e=this;n.e(4).then(n.bind(null,3)).then(e=>e.default).then(t=>{cleaner(document.querySelector(".app-layout")),this.loginPage=new t,this.loginPage.show(document.querySelector(".app-layout")),this.loginPage.addLoginCallback(t=>(conector.login(this.loginPage.username.value,this.loginPage.password.value).then(t=>{!0===t.success&&e.home()}),t.stopPropagation(),!1))})}}home(){return conector.isLoggedIn()?conector.hasActivePoll()?(this.homePage?this.homePage.show():n.e(3).then(n.bind(null,7)).then(e=>e.default).then(e=>{this.homePage=new e,cleaner(document.querySelector(".app-layout")),this.homePage.show(document.querySelector(".app-layout"))}),null):this.eventsList():this.login()}eventsList(){return this.listPage?this.listPage.show():Promise.resolve().then(n.bind(null,4)).then(e=>e.default).then(e=>{this.listPage=new e,cleaner(document.querySelector(".app-layout")),this.listPage.show(document.querySelector(".app-layout"))}),null}scanner(){return this.scannerPage?this.scannerPage.show():n.e(5).then(n.bind(null,8)).then(e=>e.default).then(e=>{this.scannerPage=new e,cleaner(document.querySelector(".app-layout")),this.scannerPage.show(document.querySelector(".app-layout"))}),null}searcher(){return this.searcherPage?this.searcherPage.show():n.e(6).then(n.bind(null,9)).then(e=>e.default).then(e=>{this.searcherPage=new e,cleaner(document.querySelector(".app-layout")),this.searcherPage.show(document.querySelector(".app-layout"))}),null}counter(){return this.counterPage?this.counterPage.show():n.e(2).then(n.bind(null,10)).then(e=>e.default).then(e=>{this.counterPage=new e,cleaner(document.querySelector(".app-layout")),this.counterPage.show(document.querySelector(".app-layout"))}),null}}n(11),n(5);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{}).catch(e=>{console.log("SW registration failed: ",e)})}),window.addEventListener("DOMContentLoaded",()=>{window.iOS=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0,window.isMediaStreamAPISupported=navigator&&navigator.mediaDevices&&"enumerateDevices"in navigator.mediaDevices,window.noCameraPermission=!1;document.querySelector(".app__select-photos"),document.querySelector(".app__dialog"),document.querySelector(".app__dialog-overlay"),document.querySelector(".app__dialog-open"),document.querySelector(".app__dialog-register"),document.querySelector(".app__dialog-close"),document.querySelector(".custom-scanner"),document.querySelector("#result"),document.querySelector("#div_content"),document.querySelector(".app__help-text"),document.querySelector(".app__header-icon svg"),document.querySelector("video"),document.querySelector(".app__menu"),document.querySelector(".app__menu_list"),document.querySelector("li.select_poll"),document.querySelector("li.register_no_qr"),document.querySelector("div#div_content"),document.querySelector("#app__title"),document.querySelector("li.scan_qr"),document.querySelector("li.count_numbers");window.appOverlay=document.querySelector(".app__overlay"),window.addEventListener("load",e=>{window.conector=new a,window.nav=new r,conector.getConfig().then(e=>nav.home())}),window.cleaner=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)}})},,,,,function(e,t){}]);