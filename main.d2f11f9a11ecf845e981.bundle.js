!function(e){function t(t){for(var n,o,a=t[0],s=t[1],r=0,c=[];r<a.length;r++)o=a[r],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&c.push(i[o][0]),i[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(l&&l(t);c.length;)c.shift()()}var n={},i={1:0};function o(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var a=new Promise((function(t,o){n=i[e]=[t,o]}));t.push(n[2]=a);var s,r=document.createElement("script");r.charset="utf-8",r.timeout=120,o.nc&&r.setAttribute("nonce",o.nc),r.src=function(e){return o.p+""+({}[e]||e)+".d2f11f9a11ecf845e981.bundle.js"}(e);var l=new Error;s=function(t){r.onerror=r.onload=null,clearTimeout(c);var n=i[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+o+": "+a+")",l.name="ChunkLoadError",l.type=o,l.request=a,n[1](l)}i[e]=void 0}};var c=setTimeout((function(){s({type:"timeout",target:r})}),12e4);r.onerror=r.onload=s,document.head.appendChild(r)}return Promise.all(t)},o.m=e,o.c=n,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var a=window.webpackJsonp=window.webpackJsonp||[],s=a.push.bind(a);a.push=t,a=a.slice();for(var r=0;r<a.length;r++)t(a[r]);var l=s;o(o.s=6)}([function(e,t){var n={},i=document.querySelector(".app__snackbar"),o=null;n.show=(e,t=4e3)=>{e&&(o&&o.remove(),(o=document.createElement("div")).className="app__snackbar-msg",o.textContent=e,i.appendChild(o),setTimeout(()=>{o.remove()},t))},t.snackbar=n},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(0);class o{constructor(){this.name=null,this.layout=document.createElement("div"),this.layout.classList.add("page-layout"),this.layout.appendChild(this.addHeaderBar()),this.layout.appendChild(this.addPageContent())}getName(){return this.name}addHeaderBar(){return this.header=document.createElement("div"),this.header.classList.add("page-header"),this.logout=document.createElement("button"),this.logout.classList.add("logout-button"),this.logout.addEventListener("click",e=>conector.logout().then(e=>{i.snackbar.show("You have been logged out"),nav.login()}),!1),this.header.appendChild(this.logout),this.app_title=document.createElement("div"),this.app_title.classList.add("app-title"),this.app_title.addEventListener("click",e=>{nav.eventsList()},!1),conector.addEventListener("poll-change",e=>{this.app_title.innerText=e.name}),conector.hasActivePoll()?this.app_title.innerText=conector.getActivePoll().name:this.app_title.innerText="QR Scanner (pendiente seleciÃ³n de evento)",this.header.appendChild(this.app_title),this.header}addPageContent(){return this.content=document.createElement("div"),this.content.classList.add("page-content"),this.content}show(e){nav.backupPage(this),e&&!this.container&&(this.container=e),cleaner(this.container),this.container.appendChild(this.layout)}addNavigationBlock(e){this.navigationBlock=document.createElement("div"),this.navigationBlock.classList.add("navigation-bar"),e.appendChild(this.navigationBlock),this.backButton=document.createElement("button"),this.backButton.classList.add("back-arrow"),conector.hasActivePoll()||this.backButton.classList.add("invisible"),this.backButton.addEventListener("click",e=>{nav.home()},!1),this.navigationBlock.appendChild(this.backButton)}addNavigationTitle(e){this.title=document.createElement("div"),this.title.innerText=e,this.title.classList="div-title",this.navigationBlock.appendChild(this.title)}}},function(e,t,n){"use strict";var i=n(0),o={};function a(e){!e&&window.isMediaStreamAPISupported?o.webcam=document.querySelector("video"):o.webcam=document.querySelector("img")}o.active=!1,o.webcam=null,o.canvas=null,o.ctx=null,o.decoder=null,o.setCanvas=()=>{o.canvas=document.createElement("canvas"),o.ctx=o.canvas.getContext("2d")},o.init=()=>{var e=!1;function t(){o.canvas.width=window.innerWidth,o.canvas.height=window.innerHeight}function n(e){navigator.mediaDevices.getUserMedia(e).then((function(e){o.webcam.srcObject=e,o.webcam.setAttribute("playsinline",!0),o.webcam.setAttribute("controls",!0),setTimeout(()=>{document.querySelector("video").removeAttribute("controls")})})).catch((function(e){console.log("Error occurred ",e),s()}))}function s(){window.noCameraPermission=!0,document.querySelector(".custom-scanner").style.display="none",i.snackbar.show("Unable to access the camera",1e4)}a(),o.setCanvas(),o.decoder=new Worker("decoder.js"),window.isMediaStreamAPISupported?o.webcam.addEventListener("play",(function(n){e||(t(),e=!0)}),!1):t(),window.isMediaStreamAPISupported&&navigator.mediaDevices.enumerateDevices().then((function(e){var t,i=e.filter((function(e){e.label.split(",")[1];if("videoinput"==e.kind)return e}));i.length>1?(t={video:{mandatory:{sourceId:i[1].deviceId?i[1].deviceId:null}},audio:!1},window.iOS&&(t.video.facingMode="environment"),n(t)):i.length?(t={video:{mandatory:{sourceId:i[0].deviceId?i[0].deviceId:null}},audio:!1},window.iOS&&(t.video.facingMode="environment"),n(t)):n({video:!0})})).catch((function(e){s(),console.error("Error occurred : ",e)}))},o.scan=function(e,t){function n(){if(o.active)try{o.ctx.drawImage(o.webcam,0,0,o.canvas.width,o.canvas.height);var e=o.ctx.getImageData(0,0,o.canvas.width,o.canvas.height);e.data&&o.decoder.postMessage(e)}catch(e){"NS_ERROR_NOT_AVAILABLE"==e.name&&setTimeout(n,0)}}o.active=!0,o.setCanvas(),o.decoder.onmessage=function(t){if(t.data.length>0){var i=t.data[0][2];o.active=!1,e(i)}setTimeout(n,0)},setTimeout(()=>{a(t)}),n()},t.a=o},,function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var i=n(1),o=n(0);class a extends i.a{constructor(){super(),this.name="list",this.list=null,null!==localStorage.getItem("events-list")&&(this.list=JSON.parse(localStorage.getItem("events-list"))),this.contentBlock=document.createElement("div"),this.contentBlock.classList.add("content-block","content-list"),this.addNavigationBlock(this.contentBlock),this.addNavigationTitle("Listado"),this.contentList=document.createElement("ul"),this.contentList.classList.add("content-list-ul"),this.contentBlock.appendChild(this.contentList);var e=null;conector.events().then(e=>{e.data.length>0&&(this.list=e.data||null)}),new Promise((e,t)=>{if(null!==this.list)e(this.list);else{const n=setInterval(()=>{null!==this.list&&(clearInterval(n),this.list.length>0?e(this.list):t("Lista de eventos vacia"))},1e3)}}).catch(e=>o.snackbar.show(e)).then(e=>(e.length>0&&localStorage.setItem("events-list",JSON.stringify(e)),e)).then(t=>(cleaner(this.contentList),this.list.forEach(t=>{(e=document.createElement("li")).classList.add("list-item"),e.setAttribute("event",JSON.stringify(t)),e.addEventListener("click",e=>{localStorage.setItem("api-poll",e.target.parentElement.parentElement.getAttribute("event")),conector.reloadActivePoll(),nav.back()},!1);var n=document.createElement("div"),i=document.createElement("span");i.classList.add("span-event-name"),i.innerText=t.name,n.appendChild(i),e.appendChild(n);var o=document.createElement("span");o.classList.add("count-badge"),o.innerHTML="&nbsp;",n.appendChild(o);var a=document.createElement("button");a.classList.add("check-event"),n.appendChild(a),this.contentList.appendChild(e)}),document.querySelectorAll("li.list-item div button").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation();var t=JSON.parse(e.target.parentElement.parentElement.getAttribute("event"));conector.countNum(t.id).then(t=>{for(let n of e.target.parentNode.children)n.classList.contains("count-badge")&&(n.innerText=t.numrows)})},!1)}),t))}show(e){nav.backupPage(this),this.container&&this.container.contains(this.content)||super.show(e),cleaner(this.content),this.content.appendChild(this.contentBlock)}}},function(e,t){e.exports=function(e){if("string"!=typeof e)return!1;var t=e.match(n);if(!t)return!1;var a=t[1];if(!a)return!1;if(i.test(a)||o.test(a))return!0;return!1};var n=/^(?:\w+:)?\/\/(\S+)$/,i=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,o=/^[^\s\.]+\.\S{2,}$/},function(e,t,n){"use strict";n.r(t);n(2);var i=n(0);var o={show:function(){document.querySelector(".dialog_div_overlay").classList.remove("hide")},hide:function(){document.querySelector(".dialog_div_overlay").classList.add("hide")}};class a{constructor(){this.config=null,this.passport=null,this.poll=null,this.pool={},this.getPassport(),this.hasActivePoll()}getConfig(){return null!==this.config?new Promise(()=>this.config):fetch("config.json").then(e=>e.json()).then(e=>(this.config=e,this.config)).catch(e=>{i.snackbar.show("Failed to load configuration")})}isLoggedIn(){return null!==this.getPassport()}hasActivePoll(){return null!==this.getActivePoll()}getPassport(){return null===this.passport&&(this.passport=localStorage.getItem("api-passport")),this.passport}getActivePoll(){return null===this.poll&&null!==localStorage.getItem("api-poll")&&(this.poll=JSON.parse(localStorage.getItem("api-poll")),this.trigger("poll-change",this.poll)),this.poll}reloadActivePoll(){return this.poll=JSON.parse(localStorage.getItem("api-poll")),this.trigger("poll-change",this.poll),this.poll}login(e,t){return this.fetch(this.url({service:"Login",login:e,password:t})).then(e=>(!0===e.success&&(this.passport=e.passport,localStorage.setItem("api-passport",this.passport)),i.snackbar.show(e.message),e))}url(e){return e=Object.assign({},this.config.params,e),this.isLoggedIn()&&(e=Object.assign({},e,{passport:this.getPassport()})),this.config.url+"?"+new URLSearchParams(e).toString()}logout(){return new Promise((e,t)=>{this.isLoggedIn()||t(),this.passport=null,nav.listPage.list=null,localStorage.removeItem("events-list"),localStorage.removeItem("api-passport"),localStorage.removeItem("api-poll"),e()})}checkQR(e){return this.hasActivePoll()?this.fetch(this.url({service:"Poll",action:"checkQR",poll:this.getActivePoll().id,data:e})):new Promise((t,n)=>{i.snackbar.show("Todavia no tiene elegido ningun evento"),n(e)})}countNum(e){return this.fetch(this.url({service:"Poll",action:"countQrChecked",poll:e}))}fetch(e,t){return o.show(),fetch(e,t).then(e=>(o.hide(),e.json())).catch(e=>(o.hide(),i.snackbar.show(e),e))}events(){return this.fetch(this.url({service:"Poll",action:"getList"}))}checkUser(e){return this.fetch(this.url({service:"Poll",action:"checkUser",user:e,poll:this.getActivePoll().id}))}setAnswer(e,t){return this.fetch(this.url({service:"Poll",action:"setVote",user:e,poll:this.getActivePoll().id,answer:t}))}addEventListener(e,t){void 0===this.pool[e]&&(this.pool[e]=[]),this.pool[e].push(t)}removeEventListeners(e){void 0!==this.pool[e]&&delete this.pool[e]}trigger(e,t){void 0!==this.pool[e]&&this.pool[e].forEach(e=>{e(t)})}}n(4);class s{constructor(){this.current=null,this.last=null}backupPage(e){null!==this.current&&e.getName()===this.current.getName()||(this.last=this.current,this.current=e)}back(){if(null!==this.current&&null!==this.last){var e=this.current;this.current=this.last,this.last=e,this.current.show()}}login(){if(this.loginPage)this.loginPage.show();else{const e=this;n.e(4).then(n.bind(null,3)).then(e=>e.default).then(t=>{cleaner(document.querySelector(".app-layout")),this.loginPage=new t,this.loginPage.show(document.querySelector(".app-layout")),this.loginPage.addLoginCallback(t=>(conector.login(this.loginPage.username.value,this.loginPage.password.value).then(t=>{!0===t.success&&e.home()}),t.stopPropagation(),!1))})}}home(){return conector.isLoggedIn()?conector.hasActivePoll()?(this.homePage?this.homePage.show():n.e(3).then(n.bind(null,7)).then(e=>e.default).then(e=>{this.homePage=new e,cleaner(document.querySelector(".app-layout")),this.homePage.show(document.querySelector(".app-layout"))}),null):this.eventsList():this.login()}eventsList(){return this.listPage?this.listPage.show():Promise.resolve().then(n.bind(null,4)).then(e=>e.default).then(e=>{this.listPage=new e,cleaner(document.querySelector(".app-layout")),this.listPage.show(document.querySelector(".app-layout"))}),null}scanner(){return this.scannerPage?this.scannerPage.show():n.e(5).then(n.bind(null,8)).then(e=>e.default).then(e=>{this.scannerPage=new e,cleaner(document.querySelector(".app-layout")),this.scannerPage.show(document.querySelector(".app-layout"))}),null}searcher(){return this.searcherPage?this.searcherPage.show():n.e(6).then(n.bind(null,9)).then(e=>e.default).then(e=>{this.searcherPage=new e,cleaner(document.querySelector(".app-layout")),this.searcherPage.show(document.querySelector(".app-layout"))}),null}counter(){return this.counterPage?this.counterPage.show():n.e(2).then(n.bind(null,10)).then(e=>e.default).then(e=>{this.counterPage=new e,cleaner(document.querySelector(".app-layout")),this.counterPage.show(document.querySelector(".app-layout"))}),null}}n(11),n(5);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{}).catch(e=>{console.log("SW registration failed: ",e)})}),window.addEventListener("DOMContentLoaded",()=>{window.iOS=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0,window.isMediaStreamAPISupported=navigator&&navigator.mediaDevices&&"enumerateDevices"in navigator.mediaDevices,window.noCameraPermission=!1,window.appOverlay=document.querySelector(".app__overlay"),window.addEventListener("load",e=>{window.conector=new a,window.nav=new s,conector.getConfig().then(e=>nav.home())}),window.cleaner=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)}})},,,,,function(e,t){}]);